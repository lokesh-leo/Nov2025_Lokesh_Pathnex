# Day 15 â€” Java, S3 Bucket, CronJob, File Reader

## ðŸ”¹ Ansible â€” Install Java & Set JAVA_HOME

---
  - name: Install Java on Pathnex server
    hosts: all
    become: yes

    tasks:
      - name: Install openjdk
        yum:
          name: java-11-openjdk
          state: present
      - name: Set JAVA_HOME
        lineinfile:
          path: /etc/profile
          line: 'export JAVA_HOME=/usr/lib/jvm/java-11-openjdk'
<!-- This ensures JAVA_HOME is set for all users after login (requires source /etc/profile or reboot to apply) -->

## ðŸ”¹ Terraform â€” Create S3 Bucket

provider "aws" {
  region = "us-east-1"
}

resource "aws_s3_bucket" "PathnexBucket"{
  bucket = "pathnext-devops-bucket"
  tags = {
    Name = "PathnexBucket"
  }
}
<!-- What this Terraform code does
Configures AWS provider in us-east-1.
Creates an S3 bucket named pathnext-devops-bucket.
Tags the bucket with Name = PathnexBucket -->

## ðŸ”¹ Kubernetes â€” CronJob

apiVersion: batch/v1
kind: CronJob
metadata:
 name: pathnex-cron
spec:
 scheduler: "*/5 * * * *"    #Means run every 5 minutes.
 jobTemplate:
   spec:
     template:
       spec:
         containers:
           - name: job
             image: busybox
             command: ["sh","-c","echo Pathnex cronjob running"] 
         restartPolicy: OnFailure

<!-- What this CronJob does
Every 5 minutes, Kubernetes creates a Job.
Job runs a pod with busybox.
Container prints:
Pathnex cronjob running
If the pod fails, Kubernetes will retry because of OnFailure. -->

## ðŸ”¹ Shell Script â€” Read File Line-by-Line

#!/bin/bash

FILE="/etc/passwd"

while read line; do
  echo "Line: $line"
done < $FILE

<!-- What it does
Reads /etc/passwd line by line.
Prints each line with Line: prefix.
Example output:
Line: root:x:0:0:root:/root:/bin/bash
Line: daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
Line: bin:x:2:2:bin:/bin:/usr/sbin/nologin -->

# Advanced Notifications

## ðŸ”¹ Jenkins Pipeline â€” Slack Notification
You will learn how to **send Slack notifications after build success or failure**.

pipeline {
  agent any
  environment {
    INSTITUTE_NAME = "Pathnex"
    SLACK_CHANNEL = "#devops"
  }
  stages {
    stage('Checkout'){
      steps {
        git url: 'https://github.com/Pathnex/sample-java-app.git'
      }
    }
    stage('Build'){
      steps {
        sh 'mvn clean package'
      }
    }
  }
  post {
    success {
      slackSend(channel:"$SLACK_CHANNEL", message: "SUCCESS: $INSTITUTE_NAME Build #$(env.BUILD_NUMBER)")
    }
    failure {
      slackSend(channel:"$SLACK_CHANNEL", message: "FAILURE: $INSTITUTE_NAME Build #$(env.BUILD_NUMBER)")
    }
  }
}
<!-- Summary
Checks out code from GitHub.
Builds a Maven project.
Sends Slack notifications on success or failure.
Uses environment variables to customize messages. -->

## ðŸ”¹ GitLab CI â€” Slack Notification
You will learn how to **notify Slack in GitLab CI**.

stages:
  - build

variables:
  INSTITUTE_NAME: "Pathnex"
  SLACK_WEBHOOK: "https://hooks.slack.com/services/abcd/efgh"

build:
  stage: build
  image: maven:3.8.1-jdk-17
  script:
    - git clone https://github.com/Pathnex/sample-java-app.git
    - cd sample-java-app
    - mvn clean package
    - curl -X POST -H 'Content-Type: application/json' --data '{"text":"Build success for Pathnex"}' $SLACK_WEBHOOK

    How it works

<!-- GitLab starts the pipeline.
It executes the build job in a Maven container.
Once the mvn clean package step succeeds, it sends a Slack notification.
You can customize the message using $INSTITUTE_NAME if needed. -->