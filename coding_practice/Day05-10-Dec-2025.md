# Day 05 â€” Handlers, User-Data, Resource Limits
## ðŸ”¹ Ansible â€” Handler to Restart Nginx

----
name: Manage Nginx
hosts: all
become: yes

tasks:
  - name: Update Config file   
    copy:                      #The copy module uploads the local index.html to the remote server
      src: index.html
      dest: /usr/share/nginx/html/index.html
    notify: Restart nginx      #The notify: triggers a handler called "Restart nginx".

handlers:                      #A handler is a special task that runs only when notified.
  - name: Restart nginx
    service:                   #It restarts the nginx service using the service module
      name: nginx
      state: restarted

## ðŸ”¹ Terraform â€” EC2 with User Data (c6a.12xlarge)
resource "aws_instance" "PathnexEC2"{    #This is a very large, compute-optimized EC2 instance with:
  ami   = "ami-12345678"                 #~48 vCPUs,~96 GB RAM
  instance_type  ="c6a.12xlarge"

  user_data =<<EOF      
  #User Data is a script that runs automatically when the EC2 instance boots for the very first time

#!/bin/bash
yum install -y httpd
systemctl start httpd            #Starts Apache Service
EOF
  tags{
    name= "Pathnex-EC2"
  }
} 

## ðŸ”¹ Kubernetes â€” Resource Limits
apiVersion: v1
kind: Pod
metadata
  name: pathnex-limited-pod
spec:
  containers:
    - name: app
      image: nginx
      resources:
        limits:
          memory: "256Mi"
          cpu: "500m"
#The container has resource limits: Memory limit: 256MiB of RAM. CPU limit: 500millicpu (0.5 CPU core)

# Day 05 â€” Environment Variables

## ðŸ”¹ Jenkins Pipeline â€” Use Environment Variables
You will learn how to **use environment variables in Jenkins pipelines**.

pipeline {
  agent any
  environment {
    COMPANY_NAME ="Nokia"   # This declares a global environment variable for the entire pipeline.
  }
  stages {
    stage ('print'){
      steps {
        sh 'echo "Welcome to $COMPANY_NAME"'   # print Welcome to Nokia
      }
    }
    stage ('build'){
      steps{      #This sends the Jenkins environment variable into Maven as a Java system property:
        sh 'mvn clean package -Dcompany.name=$COMPANY_NAME'
      }
    }
  }
}


# The pipeline defines:
# A global environment variable
# A stage that prints the variable
# A stage that passes the variable to Maven

## ðŸ”¹ GitLab CI â€” Use Environment Variables
You will learn how to **use CI variables in GitLab pipelines**.

stages:
  - build

variables:
  COMPANY_NAME: "NOKIA"

build:
  stage: build
  image: maven:3.8.1-jdk-17
  script:
    - git clone https://github.com/Pathnex/sample-java-app.git
    - cd sample-java-app
    - echo "WELCOME TO $COMPANY_NAME"
    - mvn clean package -DCompany.name=$COMPANY_NAME 
Inside your Java application, you can read it using:System.getProperty("Company.name");
This pipeline:
Defines a CI variable (COMPANY_NAME)
Runs a build stage using a Maven Docker image
Prints the variable
Passes the variable into Maven as a system property