# Day 04 â€” More Packages, Key Pair, Service

## ðŸ”¹ Ansible â€” Install Multiple Packages

---
- name: Install packages for Pathnex
  hosts: all
  become: yes

  tasks:
    - name: install tools
      yum:
        name:         # yum redhat package manager will download git and wget
        - git
        - wget
        state: present

## ðŸ”¹ Terraform â€” EC2 with Key Pair (c6i.8xlarge)

provider "aws"{           #Specifies AWS as the cloud provider
  region = "us-west-1"
}

resource "aws_key_pair" "pathnexkey"{     #Creates an EC2 key pair called PathnexKey
  key_name ="PathnexKey"
  public_key ="ssh-rsa AAAAB3NzaC1yc2EAQC..."
}

resource "aws_instance" "pathnexEC2"{
  ami ="ami-123456789"                  #the AMI ID (make sure it exists in us-west-1).
  instance_type ="c6i.8xlarge"
  key_name ="aws_key_pair.pathnexkey.key_name"
  tags ={
    Name ="Pathnex-EC2"
  }
}


## ðŸ”¹ Kubernetes â€” Create ClusterIP Service

apiVersion: v1            #This resource uses the v1 API.
kind: Service             #creating a Kubernetes Service
metadata:   
  name: pathnex-service   #Name of the service is pathnex-service
spec:
  selector:               #selector links this service to Pods that have the label:
    app:pathnex-app
  ports:
    - port: 80              #The port that the service exposes internally in the cluster.
      targetport: 80        #The port on the Pod container that receives the traffic.


# Parallel Builds
## ðŸ”¹ Jenkins Pipeline â€” Parallel Build & Test

pipeline {
  agent any               #run this pipeline on any available Jenkins agent/node
  stages {                #stage will contain multiple tasks that run at the same time.
    stage('Parallel Tasks'){
      parallel {
        stage('Build') {
          steps {
            sh'mvn clean compile'
          }
        }
        stage('test'){
          steps{
            sh 'mvn test'
          }
        }
      }
    }
  }
}

## ðŸ”¹ GitLab CI â€” Parallel Jobs
You will learn how to **run parallel jobs in GitLab CI**.

stages:
  - build-test
maven-build:
  stage: build-test
  image: maven:3.8.1-jdk-17
  script:
    - git clone https://github.com/Pathnex/sample-java-app.git
    - cd sample-java-app
    - mvn clean compile
  parallel: 1

maven-test:
  stage:build-test
  image:maven:3.8.1-jdk-17
  script:
    - cd sample-java-app
    - mvn test
  parallel: 1
