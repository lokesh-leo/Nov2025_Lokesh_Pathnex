# Day 09 â€” Templates, Internet Gateway, ConfigMap, CPU Load

## ðŸ”¹ Ansible â€” Use Jinja2 Template
---
  - name: Deploy template for Pathnex
    hosts: all
    become: yes

    tasks:
      - name: Copy template key
        template:
          src: pathnex.conf.j2
          dest: /etc/pathnex.conf
  
  <!-- What this playbook does
<!-- Connects to all hosts
Uses sudo
Takes pathnex.conf.j2
Renders it with variables
Writes the final config to /etc/pathnex.conf
Replaces the file only if content changes --> -->

## ðŸ”¹ Terraform â€” Internet Gateway

resource "aws_internet_gateway" "PathnexIGW" {
  vpc_id = aws_vpc.PathnexVPC.id

  tags = {
    Name = "Pathnex-IGW"
  }
}

<!-- What this resource does
Creates an AWS Internet Gateway
Attaches it to the Pathnex VPC
Enables internet access for resources in that VPC
Tags the gateway as Pathnex-IGW -->

## ðŸ”¹ Kubernetes â€” Create ConfigMap

apiVersion: v1
kind: ConfigMap
metadata: 
  name: pathnex-config
data:
  APP_MODE: "production"
  WELCOME_MSG: "Hello Pathnex"

<!-- What this ConfigMap does 
Creates a ConfigMap named pathnex-config
Stores application configuration:
Environment mode
Welcome message
Can be injected into Pods as:
Environment variables
Files inside containers -->


## ðŸ”¹ Shell Script â€” Check CPU Load
#!/bin/bash

LOAD=$(uptime | awk '(print $10)')

echo "Current CPU Load: $LOAD"

<!-- What this script does
Uses uptime to check system load.
Extracts the CPU load value using awk.
Stores it in a variable.
Prints the current CPU load. -->

# Artifacts and Archiving

## ðŸ”¹ Jenkins Pipeline â€” Archive Artifacts
You will learn how to **save build artifacts for future use**.

pipeline {
  agent any
  environment {
    INSTITUTE_NAME = "Pathnex"
  }
  stages {
    stage('Checkout') {
      steps {
        git url: 'https://github.com/Pathnex/sample-java-app.git'
      }
    }
    stage('Build') {
      steps {
        sh 'mvn clean package'
      }
    }
    stage('Archive') {
      steps {
        archiveArtifacts artifacts: 'target/*.jar' , fingerprint: true
      }
    }
  }
}

<!-- archiveArtifacts â†’ Jenkins step to store build outputs.
artifacts: 'target/*.jar':
Archives all JAR files created in the target directory.
fingerprint: true:
Generates a unique fingerprint (hash) for each artifact.
Helps track which build produced which artifact.
Useful for tracing artifacts across pipelines. -->

## ðŸ”¹ GitLab CI â€” Artifacts
You will learn how to **store artifacts in GitLab CI**.

stages:
  - build

build:
  stage: build
  image: maven:3.8.1-jdk-17
  script:
    - git clone https://github.com/Pathnex/sample-java-app.git
    - cd sample-java-app
    - mvn clean package
  artifacts:
    paths: 
      - target/*.jar
    expire_in: 1 week

<!-- Specifies which files to store as artifacts.
Saves all .jar files inside the target directory.
Defines how long GitLab keeps the artifacts.
After 1 week, artifacts are automatically deleted.
Helps manage storage usage. -->

